/**
 * ÂºÄÂèëÂú∞Â∏¶È°µÈù¢ÂäüËÉΩËÑöÊú¨
 * Â§ÑÁêÜÈ°πÁõÆÂ±ïÁ§∫„ÄÅÁä∂ÊÄÅÁ≠õÈÄâÁ≠âÂäüËÉΩ
 */

class DevelopmentManager {
    constructor() {
        this.apiService = window.apiService;
        this.currentStatus = 'all';
        this.projects = [];
        this.isLoading = false;
        
        this.init();
    }

    async init() {
        try {
            await this.loadProjects();
            this.setupEventListeners();
            this.hideLoadingIndicator();
        } catch (error) {
            console.error('ÂàùÂßãÂåñÂºÄÂèëÂú∞Â∏¶Â§±Ë¥•:', error);
            this.showError('Âä†ËΩΩÈ°πÁõÆÊï∞ÊçÆÂ§±Ë¥•ÔºåËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï');
        }
    }

    async loadProjects() {
        this.showLoadingIndicator();
        this.isLoading = true;

        try {
            // Â∞ùËØï‰ªéAPIÂä†ËΩΩÈ°πÁõÆÊï∞ÊçÆ
            // const data = await this.apiService.getProjects();
            // this.projects = data.projects || [];
            
            // ‰ΩøÁî®Ê®°ÊãüÊï∞ÊçÆ
            this.projects = this.getMockProjects();
            this.renderProjects();
        } catch (error) {
            console.error('Âä†ËΩΩÈ°πÁõÆÂ§±Ë¥•:', error);
            this.projects = this.getMockProjects();
            this.renderProjects();
        } finally {
            this.hideLoadingIndicator();
            this.isLoading = false;
        }
    }

    getMockProjects() {
        return [
            {
                id: 1,
                title: 'H5Ê∏∏Êàè‰∏ñÁïå',
                description: 'Âü∫‰∫éHTML5ÊäÄÊúØÁöÑÁΩëÈ°µÊ∏∏ÊàèÂπ≥Âè∞ÔºåÊó†ÈúÄ‰∏ãËΩΩÂÆâË£ÖÂç≥ÂèØÁïÖÁé©„ÄÇÊî∂ÂΩï‰∫ÜÂêÑÁ±ªÁªèÂÖ∏Ê∏∏Êàè„ÄÅÁõäÊô∫Ê∏∏ÊàèÂíå‰ºëÈó≤Ê∏∏ÊàèÔºåÊîØÊåÅÊâãÊú∫ÂíåÁîµËÑëÊµèËßàÂô®Áõ¥Êé•ËøêË°å„ÄÇ',
                status: 'active',
                icon: 'üéÆ',
                technologies: ['HTML5', 'Canvas', 'JavaScript', 'Web Audio'],
                githubUrl: 'https://github.com/yourusername/h5-games',
                demoUrl: 'https://h5.171780.xyz',
                features: ['Âç≥ÁÇπÂç≥Áé©', 'Ë∑®Âπ≥Âè∞', 'Êó†ÈúÄÂÆâË£Ö', 'ÂìçÂ∫îÂºèËÆæËÆ°'],
                startDate: '2024-08-01',
                lastUpdate: '2025-10-15'
            },
            {
                id: 2,
                title: 'ÁôΩÂô™Èü≥ÊîæÊùæÁ´ô',
                description: '‰∏ìÊ≥®Âäõ‰∏éÊîæÊùæÁöÑÂ£∞Èü≥‰∏ñÁïå„ÄÇÊèê‰æõÂ§ßËá™ÁÑ∂ÁôΩÂô™Èü≥„ÄÅÁéØÂ¢ÉÈü≥Êïà„ÄÅÂÜ•ÊÉ≥Èü≥‰πêÁ≠âÂ§öÁßçÂ£∞Èü≥Âú∫ÊôØÔºåÂ∏ÆÂä©‰Ω†‰∏ìÊ≥®Â∑•‰Ωú„ÄÅÊîæÊùæË∫´ÂøÉ„ÄÅÊîπÂñÑÁù°Áú†Ë¥®Èáè„ÄÇ',
                status: 'active',
                icon: 'üéµ',
                technologies: ['Web Audio API', 'React', 'CSS3', 'IndexedDB'],
                githubUrl: 'https://github.com/yourusername/white-noise',
                demoUrl: 'https://mood.171780.xyz',
                features: ['Â§öÁßçÂú∫ÊôØ', 'ÂÆöÊó∂ÂäüËÉΩ', 'Ê∑∑Èü≥Âô®', 'Êî∂ËóèÂàóË°®'],
                startDate: '2024-09-10',
                lastUpdate: '2025-10-12'
            },
            {
                id: 3,
                title: 'DrawËôöÊãüÁôΩÊùø',
                description: 'Âú®Á∫øÊâãÁªòÈ£éÊ†ºÂõæË°®ÁªòÂà∂Â∑•ÂÖ∑„ÄÇÊîØÊåÅÊµÅÁ®ãÂõæ„ÄÅÊû∂ÊûÑÂõæ„ÄÅÊÄùÁª¥ÂØºÂõæÁ≠âÂ§öÁßçÂõæË°®Á±ªÂûãÔºåÈááÁî®ÊâãÁªòÈ£éÊ†ºÂëàÁé∞ÔºåËÆ©‰Ω†ÁöÑÂõæË°®Êõ¥ÂÖ∑‰∏™ÊÄßÂíåËâ∫ÊúØÊÑü„ÄÇ',
                status: 'active',
                icon: '‚úèÔ∏è',
                technologies: ['Canvas', 'SVG', 'Excalidraw', 'TypeScript'],
                githubUrl: 'https://github.com/yourusername/draw-board',
                demoUrl: 'https://draw.171780.xyz',
                features: ['ÊâãÁªòÈ£éÊ†º', 'ÂÆûÊó∂Âçè‰Ωú', 'ÂØºÂá∫Â§öÊ†ºÂºè', '‰∏∞ÂØåÁªÑ‰ª∂Â∫ì'],
                startDate: '2024-07-15',
                lastUpdate: '2025-10-18'
            },
            {
                id: 4,
                title: 'ITÂ∑•ÂÖ∑ÁôæÂÆùÁÆ±',
                description: '‰∏∫ÂºÄÂèëËÄÖÁ≤æÂøÉÂáÜÂ§áÁöÑÂú®Á∫øÂ∑•ÂÖ∑ÈõÜÂêà„ÄÇÂåÖÂê´JSONÊ†ºÂºèÂåñ„ÄÅBase64ÁºñËß£Á†Å„ÄÅÊó∂Èó¥Êà≥ËΩ¨Êç¢„ÄÅÊ≠£ÂàôÊµãËØï„ÄÅÈ¢úËâ≤ÈÄâÊã©Âô®„ÄÅÂä†ÂØÜËß£ÂØÜÁ≠âÊï∞ÂçÅÁßçÂÆûÁî®Â∑•ÂÖ∑„ÄÇ',
                status: 'active',
                icon: 'üõ†Ô∏è',
                technologies: ['Vue.js', 'TypeScript', 'Vite', 'TailwindCSS'],
                githubUrl: 'https://github.com/yourusername/it-tools',
                demoUrl: 'https://ittools.171780.xyz',
                features: ['Â∑•ÂÖ∑ÈΩêÂÖ®', 'Á∫ØÂâçÁ´Ø', 'ÈöêÁßÅÂÆâÂÖ®', 'Âø´ÈÄü‰æøÊç∑'],
                startDate: '2024-06-20',
                lastUpdate: '2025-10-20'
            },
            {
                id: 5,
                title: 'Âú®Á∫øÂΩ±ËßÜ‰∏≠ÂøÉ',
                description: 'ËÅöÂêàÂºèÂú®Á∫øËßÜÈ¢ëÊí≠ÊîæÂπ≥Âè∞„ÄÇÊï¥Âêà‰∫ÜÂ§ö‰∏™ËßÜÈ¢ëÊ∫êÔºåÊèê‰æõÁîµÂΩ±„ÄÅÁîµËßÜÂâß„ÄÅÁªºËâ∫„ÄÅÂä®Êº´Á≠âÊµ∑ÈáèÂΩ±ËßÜËµÑÊ∫êÔºåÊîØÊåÅÊêúÁ¥¢„ÄÅÂàÜÁ±ª„ÄÅÊî∂ËóèÂíåÊí≠ÊîæÂéÜÂè≤ËÆ∞ÂΩï„ÄÇ',
                status: 'active',
                icon: 'üì∫',
                technologies: ['React', 'Node.js', 'Video.js', 'MongoDB'],
                githubUrl: 'https://github.com/yourusername/online-tv',
                demoUrl: 'https://tv.171780.xyz',
                features: ['Êµ∑ÈáèËµÑÊ∫ê', 'È´òÊ∏ÖÊí≠Êîæ', 'Êô∫ËÉΩÊé®Ëçê', 'Êñ≠ÁÇπÁª≠Êí≠'],
                startDate: '2024-05-01',
                lastUpdate: '2025-10-16'
            }
        ];
    }

    setupEventListeners() {
        // Áä∂ÊÄÅÁ≠õÈÄâ
        const filterButtons = document.querySelectorAll('.filter-btn');
        filterButtons.forEach(btn => {
            btn.addEventListener('click', (e) => {
                const status = e.target.getAttribute('data-status');
                this.filterByStatus(status);
            });
        });
    }

    filterByStatus(status) {
        // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        document.querySelector(`[data-status="${status}"]`).classList.add('active');

        this.currentStatus = status;
        this.renderProjects();
    }

    renderProjects() {
        const grid = document.getElementById('projectGrid');
        if (!grid) return;

        const filteredProjects = this.getFilteredProjects();
        
        if (filteredProjects.length === 0) {
            grid.innerHTML = this.getEmptyStateHTML();
            return;
        }

        const projectsHTML = filteredProjects.map(project => this.createProjectHTML(project)).join('');
        grid.innerHTML = projectsHTML;

        // Ê∑ªÂä†ÈìæÊé•ÁÇπÂáª‰∫ã‰ª∂
        grid.querySelectorAll('.project-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.stopPropagation();
                // ÈìæÊé•Â∑≤ÁªèÂú®HTML‰∏≠ËÆæÁΩÆ‰∫Ütarget="_blank"ÔºåËøôÈáå‰∏çÈúÄË¶ÅÈ¢ùÂ§ñÂ§ÑÁêÜ
            });
        });
    }

    getFilteredProjects() {
        if (this.currentStatus === 'all') {
            return this.projects;
        }
        return this.projects.filter(project => project.status === this.currentStatus);
    }

    createProjectHTML(project) {
        const statusClass = project.status;
        const statusText = this.getStatusText(project.status);
        const statusIcon = this.getStatusIcon(project.status);
        
        return `
            <div class="project-item" data-status="${project.status}">
                <div class="project-header">
                    <h3 class="project-title">
                        <span class="project-icon">${project.icon}</span>
                        ${project.title}
                    </h3>
                    <span class="project-status ${statusClass}">
                        ${statusIcon} ${statusText}
                    </span>
                </div>
                
                <p class="project-description">${project.description}</p>
                
                <div class="project-tech">
                    ${project.technologies.map(tech => `<span class="tech-tag">${tech}</span>`).join('')}
                </div>
                
                <div class="project-links">
                    ${project.githubUrl ? `
                        <a href="${project.githubUrl}" class="project-link github" target="_blank" rel="noopener noreferrer">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2C6.477 2 2 6.477 2 12c0 4.42 2.865 8.17 6.839 9.49.5.092.682-.217.682-.482 0-.237-.008-.866-.013-1.7-2.782.603-3.369-1.34-3.369-1.34-.454-1.156-1.11-1.463-1.11-1.463-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.087 2.91.831.092-.646.35-1.086.636-1.336-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.269 2.75 1.025A9.578 9.578 0 0112 6.836c.85.004 1.705.114 2.504.336 1.909-1.294 2.747-1.025 2.747-1.025.546 1.377.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.743 0 .267.18.578.688.48C19.138 20.167 22 16.418 22 12c0-5.523-4.477-10-10-10z"/>
                            </svg>
                            GitHub
                        </a>
                    ` : ''}
                    ${project.demoUrl ? `
                        <a href="${project.demoUrl}" class="project-link demo" target="_blank" rel="noopener noreferrer">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" stroke-width="2"/>
                                <polyline points="15,3 21,3 21,9" stroke-width="2"/>
                                <line x1="10" y1="14" x2="21" y2="3" stroke-width="2"/>
                            </svg>
                            Âú®Á∫øÊºîÁ§∫
                        </a>
                    ` : ''}
                </div>
                
                <div class="project-meta">
                    <small style="color: var(--text-gray); font-size: 0.8rem;">
                        ÂºÄÂßãÊó∂Èó¥: ${project.startDate} | ÊúÄÂêéÊõ¥Êñ∞: ${project.lastUpdate}
                    </small>
                </div>
            </div>
        `;
    }

    getStatusText(status) {
        const statusMap = {
            'active': 'Âú®Á∫øËøêË°å',
            'completed': 'Â∑≤ÂÆåÊàê',
            'maintenance': 'Áª¥Êä§‰∏≠',
            'paused': 'ÊöÇÂÅú'
        };
        return statusMap[status] || status;
    }

    getStatusIcon(status) {
        const iconMap = {
            'active': '‚ú®',
            'completed': '‚úÖ',
            'maintenance': 'üîß',
            'paused': '‚è∏Ô∏è'
        };
        return iconMap[status] || 'üìã';
    }

    getEmptyStateHTML() {
        return `
            <div class="empty-state">
                <div class="empty-icon">üîç</div>
                <h3>ÊöÇÊó†‰∫ßÂìÅ</h3>
                <p>ÂΩìÂâçÁ≠õÈÄâÊù°‰ª∂‰∏ãÊ≤°ÊúâÊâæÂà∞‰∫ßÂìÅÔºåÂ∞ùËØïÈÄâÊã©ÂÖ∂‰ªñÁä∂ÊÄÅÊü•ÁúãÊõ¥Â§öÂÜÖÂÆπ</p>
            </div>
        `;
    }

    showLoadingIndicator() {
        const indicator = document.getElementById('loadingIndicator');
        if (indicator) {
            indicator.classList.remove('hidden');
        }
    }

    hideLoadingIndicator() {
        const indicator = document.getElementById('loadingIndicator');
        if (indicator) {
            indicator.classList.add('hidden');
        }
    }

    showError(message) {
        const grid = document.getElementById('projectGrid');
        if (grid) {
            grid.innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon">‚ö†Ô∏è</div>
                    <h3>Âä†ËΩΩÂ§±Ë¥•</h3>
                    <p>${message}</p>
                </div>
            `;
        }
    }
}

// È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
document.addEventListener('DOMContentLoaded', () => {
    new DevelopmentManager();
});
