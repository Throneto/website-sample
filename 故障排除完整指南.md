# 故障排除完整指南

> 本指南整合了博客系统、缓存问题、界面显示等常见问题的解决方案。

## 📋 目录

- [博客文章问题](#博客文章问题)
- [缓存问题](#缓存问题)
- [界面显示问题](#界面显示问题)
- [模态框问题](#模态框问题)
- [图片显示问题](#图片显示问题)
- [部署更新问题](#部署更新问题)

---

## 📝 博客文章问题

### 问题：文章未显示

#### 症状
- `data/articles/` 中有文章，但博客页面不显示
- 显示的是旧的示例文章
- 点击分类筛选无效

#### 原因分析

**1. 浏览器缓存问题**

`api-service.js` 会将文章数据缓存在 `localStorage` 中：
- 首次加载后优先读取缓存
- 即使更新了 JSON 文件，浏览器仍使用旧缓存

**2. 类别名称不匹配**

- JSON 使用中文：`"技术"`、`"设计"`、`"生活"`
- HTML 使用英文：`technology`、`design`、`life`
- 导致筛选功能无法匹配

#### 解决方案

**方案一：清除 localStorage（立即生效）**

1. 打开博客页面
2. 按 `F12` 打开开发者工具
3. 在控制台（Console）输入：
```javascript
localStorage.removeItem('valarz_articles');
location.reload();
```

**方案二：统一类别名称**

确保 HTML 和 JSON 使用相同的类别名称：

```html
<!-- pages/blog.html -->
<div class="category-filter">
    <button class="filter-btn active" data-category="all">全部</button>
    <button class="filter-btn" data-category="技术">技术</button>
    <button class="filter-btn" data-category="设计">设计</button>
    <button class="filter-btn" data-category="生活">生活</button>
</div>
```

**方案三：强制刷新文章（代码级别）**

修改 `js/blog.js`：
```javascript
async init() {
    try {
        // 强制刷新文章缓存
        await this.apiService.refreshArticles();
        await this.loadArticles();
        this.setupEventListeners();
        this.hideLoadingIndicator();
    } catch (error) {
        console.error('初始化博客失败:', error);
        this.showError('加载博客数据失败，请刷新页面重试');
    }
}
```

#### 验证方法

打开控制台查看：

```javascript
// 查看已加载的文章数量
window.apiService.getArticles().then(result => {
    console.log(`共加载 ${result.items.length} 篇文章`);
    console.log('文章列表：', result.items.map(a => a.title));
});
```

预期输出：
```
共加载 19 篇文章
[增量模式] 发现 1 个文章文件，总计 19 篇文章
✓ 加载 articles-2025-10-21.json: 19 篇
```

---

## 🗄️ 缓存问题

### 浏览器缓存清除

#### 方法一：强制刷新（最快）

**Windows/Linux:**
- `Ctrl + Shift + R`
- `Ctrl + F5`

**Mac:**
- `Command + Shift + R`
- `Command + Option + R`

#### 方法二：清除浏览器缓存

**Chrome/Edge:**
1. 按 `Ctrl + Shift + Delete` (Mac: `Command + Shift + Delete`)
2. 选择"时间范围" → "全部时间"
3. 勾选"缓存的图片和文件"
4. 点击"清除数据"
5. 刷新页面（F5）

**Firefox:**
1. 按 `Ctrl + Shift + Delete` (Mac: `Command + Shift + Delete`)
2. 选择"时间范围" → "全部"
3. 勾选"缓存"
4. 点击"立即清除"
5. 刷新页面（F5）

**Safari (Mac):**
1. 菜单栏 → 开发 → 清空缓存
2. 或 `Command + Option + E`
3. 刷新页面（Command + R）

#### 方法三：隐私/无痕模式

直接打开隐私浏览窗口测试：
- **Chrome/Edge**: `Ctrl + Shift + N`
- **Firefox**: `Ctrl + Shift + P`
- **Safari**: `Command + Shift + N`

#### 方法四：开发者工具（最彻底）

1. 按 `F12` 打开开发者工具
2. 右键点击刷新按钮
3. 选择"清空缓存并硬性重新加载"

### CDN/服务器缓存

#### Vercel Edge 缓存

如果使用 Vercel 部署，可能还有 Edge 缓存：

**等待自然过期：**
- 通常 5-10 分钟

**强制清除：**
```bash
# 使用 Vercel CLI
curl -X PURGE https://your-domain.vercel.app/css/blog.css
curl -X PURGE https://your-domain.vercel.app/js/blog.js
```

**访问部署特定URL：**
```
https://your-project-abc123.vercel.app
```

#### localStorage 清除

```javascript
// 清除所有 localStorage
localStorage.clear();

// 清除特定项
localStorage.removeItem('valarz_articles');
localStorage.removeItem('article_cache_time');
```

#### Service Worker 清除

1. 打开开发者工具
2. Application → Service Workers
3. 点击 "Unregister"

### 缓存验证

#### 检查 HTTP 缓存头

1. 按 `F12` → Network 标签
2. 勾选 "Disable cache"
3. 刷新页面
4. 找到资源请求
5. 查看 Response Headers：

```
Cache-Control: public, max-age=3600, must-revalidate
```

#### 检查浏览器缓存

```javascript
// 查看缓存的资源
window.caches.keys().then(cacheNames => {
    cacheNames.forEach(cacheName => {
        console.log('Cache:', cacheName);
        caches.open(cacheName).then(cache => {
            cache.keys().then(keys => {
                console.log('Cached URLs:', keys.map(k => k.url));
            });
        });
    });
});
```

---

## 🎨 界面显示问题

### 问题：样式未生效

#### 症状
- 博客页面样式不正常
- 看不到预期的动画效果
- 搜索框、按钮样式错误

#### 诊断步骤

**1. 验证 CSS 文件加载**

打开浏览器控制台：
```javascript
// 检查样式是否加载
const style = window.getComputedStyle(document.querySelector('.article-card'));
console.log('背景:', style.background);
console.log('边框半径:', style.borderRadius);
console.log('过渡效果:', style.transition);
```

预期输出：
```
✅ 博客UI优化检查:
  - 背景: linear-gradient(...)
  - 边框半径: 24px
  - 过渡效果: all 0.4s cubic-bezier(...)
✨ 博客页面优化样式已成功加载！
```

**2. 检查网络请求**

1. 按 `F12` → Network 标签
2. 刷新页面
3. 查找 `blog.css` 文件
4. 检查：
   - URL 是否包含版本号
   - 状态码应该是 `200`（不是 `304`）
   - 内容类型是 `text/css`

**3. 直接访问 CSS 文件**

在浏览器中访问：
```
http://your-domain/css/blog.css?v=20251021-optimized
```

查看文件开头是否有：
```css
/* ========== 博客页面样式 ========== */
.blog-bg-decoration {
    position: fixed;
    ...
}
```

#### 解决方案

**方案一：清除缓存**

参考[缓存问题](#缓存问题)章节的方法。

**方案二：更新版本号**

在 HTML 中更新 CSS 引用：
```html
<link rel="stylesheet" href="../css/blog.css?v=20251021-new">
```

**方案三：检查文件路径**

确认路径正确：
```html
<!-- 从 pages/blog.html 引用 -->
<link rel="stylesheet" href="../css/blog.css">

<!-- 从根目录 HTML 引用 -->
<link rel="stylesheet" href="css/blog.css">
```

**方案四：验证文件存在**

```bash
# 检查文件
ls css/blog.css

# 查看文件内容
cat css/blog.css | head -20
```

### 视觉效果检查清单

打开博客页面后，应该能看到：

- [ ] 搜索框有圆角和青色边框
- [ ] 搜索框聚焦时出现彩色渐变边框动画
- [ ] 分类按钮是圆角的，有渐变背景
- [ ] 激活的分类按钮有流动光晕效果
- [ ] 文章卡片有深色渐变背景
- [ ] 悬停文章卡片时向上浮动并出现发光效果
- [ ] 文章卡片顶部有彩色渐变线条
- [ ] 页面上有5个缓慢漂浮的发光粒子
- [ ] 标题下方有带脉冲圆点的分隔线
- [ ] 加载指示器是三层旋转的彩色圆环

---

## 📦 模态框问题

### 问题：点击文章无反应

#### 症状
- 点击文章卡片后没有弹出模态框
- 或模态框显示但样式不正确
- ESC 键无法关闭模态框

#### 原因分析

**1. CSS 样式缺失**

模态框的 CSS 样式没有加载，导致模态框虽然创建但不可见。

**2. JavaScript 错误**

`blog.js` 中的模态框代码有错误或未加载。

**3. 事件监听器未绑定**

文章卡片的点击事件没有正确绑定。

#### 解决方案

**方案一：验证 CSS 加载**

检查 `css/blog.css` 是否包含以下样式：

```css
/* 文章模态框 */
.article-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 9999;
    animation: modalFadeIn 0.3s ease-out forwards;
}

.modal-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(10px);
}

.modal-content {
    position: relative;
    max-width: 900px;
    max-height: 90vh;
    margin: 5vh auto;
    overflow-y: auto;
    /* ... */
}
```

**方案二：检查 JavaScript**

确认 `js/blog.js` 包含模态框方法：

```javascript
// 打开文章详情模态框
openArticleModal(article) {
    // 创建模态框
    const modal = document.createElement('div');
    modal.className = 'article-modal';
    // ...
}

// 关闭模态框
closeModal() {
    const modal = document.querySelector('.article-modal');
    if (modal) {
        modal.style.animation = 'modalFadeOut 0.3s ease-out forwards';
        setTimeout(() => modal.remove(), 300);
    }
}

// Markdown 转 HTML
formatMarkdownContent(content) {
    // ...
}
```

**方案三：清除缓存并刷新**

1. 清除浏览器缓存
2. 硬刷新页面（Ctrl+F5）
3. 重新测试

**方案四：检查控制台错误**

1. 打开开发者工具（F12）
2. 切换到 Console 标签
3. 查看是否有 JavaScript 错误
4. 根据错误信息进行修复

#### 功能测试

**测试模态框打开：**
```javascript
// 在控制台执行
const article = {
    title: "测试文章",
    content: "# 测试内容\n\n这是一篇测试文章。"
};
window.blogManager.openArticleModal(article);
```

**测试模态框关闭：**
```javascript
// 方法1：点击关闭按钮
document.querySelector('.modal-close').click();

// 方法2：点击遮罩层
document.querySelector('.modal-overlay').click();

// 方法3：按ESC键
document.dispatchEvent(new KeyboardEvent('keydown', {key: 'Escape'}));
```

### Markdown 支持

模态框支持以下 Markdown 格式：

- ✅ 标题 (`#` `##` `###`)
- ✅ 粗体 (`**文字**`)
- ✅ 斜体 (`*文字*`)
- ✅ 链接 (`[文字](URL)`)
- ✅ 图片 (`![描述](URL)`)
- ✅ 代码块 (`` `代码` `` 和 ` ``` `)
- ✅ 引用 (`> 引用内容`)
- ✅ 列表 (`* ` 或 `1. `)

---

## 🖼️ 图片显示问题

### 问题：图片不显示

#### 症状
- 文章中的图片显示为 broken image
- 或图片加载失败
- 控制台显示 404 错误

#### 原因分析

**1. 路径错误**

图片路径不正确，可能是相对路径问题。

**2. 文件不存在**

图片文件没有上传或路径不对。

**3. 跨域问题**

外部图片被浏览器CORS策略阻止。

#### 解决方案

**方案一：使用正确的路径**

**本地图片：**
```markdown
<!-- 从根目录开始的绝对路径 -->
![图片描述](/assets/images/blog/my-image.jpg)

<!-- 相对于当前文件的路径 -->
![图片描述](../../assets/images/blog/my-image.jpg)
```

**外部图片：**
```markdown
<!-- 使用完整的 URL -->
![图片描述](https://cdn.example.com/my-image.jpg)
```

**方案二：验证文件存在**

```bash
# 检查图片文件
ls assets/images/blog/my-image.jpg

# 在浏览器中直接访问
https://your-domain.com/assets/images/blog/my-image.jpg
```

**方案三：使用图床服务**

推荐的图床服务：
- [imgur.com](https://imgur.com/)
- [SM.MS](https://sm.ms/)
- GitHub Issues（作为图床）

**方案四：检查图片格式**

支持的格式：
- ✅ JPEG/JPG
- ✅ PNG
- ✅ GIF
- ✅ WebP
- ✅ SVG

#### 图片优化建议

**1. 压缩图片**

使用工具压缩图片：
- [TinyPNG](https://tinypng.com/)
- [Squoosh](https://squoosh.app/)
- ImageOptim（Mac）

**2. 使用合适的格式**

- 照片：JPEG
- 透明背景：PNG
- 动画：GIF
- 图标：SVG
- 现代浏览器：WebP

**3. 懒加载**

```html
<img src="image.jpg" loading="lazy" alt="描述">
```

**4. 响应式图片**

```html
<img srcset="image-320w.jpg 320w,
             image-640w.jpg 640w,
             image-1280w.jpg 1280w"
     sizes="(max-width: 320px) 280px,
            (max-width: 640px) 600px,
            1200px"
     src="image-640w.jpg"
     alt="响应式图片">
```

---

## 🚀 部署更新问题

### 问题：部署后网站未更新

详细的部署问题解决方案请参考 [Vercel部署完整指南.md](Vercel部署完整指南.md)。

#### 快速检查清单

- [ ] Git 提交已推送到 GitHub
- [ ] Vercel 部署状态为 "Ready"
- [ ] 部署的提交哈希是最新的
- [ ] 已清除浏览器缓存（硬刷新）
- [ ] 在隐私窗口测试过
- [ ] 直接访问资源 URL 验证内容
- [ ] 检查 Network 标签中的缓存状态
- [ ] 等待了 5-10 分钟（CDN 传播）
- [ ] 尝试了部署特定 URL

#### 快速解决方案

**1. 清除缓存**
```
Ctrl + Shift + R (Windows)
Command + Shift + R (Mac)
```

**2. 强制重新部署**

在 Vercel Dashboard：
- Deployments → 选择最新部署
- 点击 "..." → "Redeploy"
- 取消勾选 "Use existing Build Cache"

**3. 验证部署**

```bash
# 检查 Git 状态
git log --oneline -5

# 访问部署特定 URL
# https://your-project-abc123.vercel.app
```

---

## 🔧 常用诊断命令

### 浏览器控制台

```javascript
// 检查文章数据
window.apiService.getArticles().then(console.log);

// 清除文章缓存
localStorage.removeItem('valarz_articles');

// 检查样式
window.getComputedStyle(document.querySelector('.article-card'));

// 查看所有缓存
window.caches.keys().then(console.log);

// 检查 Service Workers
navigator.serviceWorker.getRegistrations().then(console.log);
```

### Git 命令

```bash
# 检查状态
git status

# 查看最近提交
git log --oneline -10

# 查看文件历史
git log --follow -- css/blog.css

# 检查远程仓库
git remote -v

# 查看分支
git branch -vv
```

### Node.js 命令

```bash
# 验证 JSON 格式
node -e "console.log(JSON.parse(require('fs').readFileSync('data/articles.json', 'utf8')))"

# 运行转换工具
node tools/md-to-json-incremental.js

# 运行部署脚本
node tools/deploy.js
```

---

## 📊 问题优先级

### 紧急问题（立即处理）

- ❗ 网站无法访问
- ❗ 所有文章都不显示
- ❗ JavaScript 致命错误

### 重要问题（尽快处理）

- ⚠️ 新文章不显示
- ⚠️ 分类筛选失效
- ⚠️ 模态框无法打开

### 一般问题（计划处理）

- 💡 样式细节问题
- 💡 图片加载慢
- 💡 缓存时间调整

### 优化建议（持续改进）

- ✨ 性能优化
- ✨ SEO 改进
- ✨ 用户体验提升

---

## 📞 获取帮助

### 自助诊断

1. 查看本指南相关章节
2. 检查浏览器控制台错误
3. 验证文件是否存在
4. 测试在不同浏览器中的表现

### 文档资源

- 本指南：故障排除完整文档
- [博客系统完整指南.md](博客系统完整指南.md)
- [Vercel部署完整指南.md](Vercel部署完整指南.md)
- `tools/README.md`

### 调试技巧

**1. 使用浏览器开发者工具**
- Console：查看错误和日志
- Network：检查资源加载
- Application：查看缓存和存储
- Elements：检查 DOM 结构

**2. 逐步排除法**
- 在隐私窗口测试（排除缓存）
- 禁用浏览器扩展（排除干扰）
- 测试不同浏览器（排除兼容性）
- 直接访问资源 URL（排除路径问题）

**3. 对比测试**
- 本地 vs 生产环境
- 新环境 vs 旧环境
- 不同设备和浏览器

### 创建问题报告

如果需要寻求帮助，请提供：

```markdown
## 问题描述
简要描述遇到的问题

## 重现步骤
1. 打开 xxx 页面
2. 点击 xxx 按钮
3. 看到 xxx 错误

## 预期行为
应该显示 xxx

## 实际行为
实际显示 xxx

## 环境信息
- 浏览器：Chrome 120
- 操作系统：Windows 11
- 网站版本：v2.0

## 错误信息
```
控制台错误信息
```

## 截图
（如果适用）
```

---

## 🎯 总结

### 问题解决流程

```
1. 确认问题
   ↓
2. 查看控制台错误
   ↓
3. 清除缓存
   ↓
4. 验证文件存在
   ↓
5. 检查配置
   ↓
6. 查阅文档
   ↓
7. 寻求帮助
```

### 预防措施

- ✅ 定期备份数据
- ✅ 使用版本控制
- ✅ 测试后再部署
- ✅ 监控错误日志
- ✅ 保持文档更新

### 常用解决方案

大多数问题可以通过以下方法解决：

1. **清除缓存** - 解决 80% 的显示问题
2. **检查文件路径** - 解决资源加载问题
3. **验证配置** - 解决功能异常问题
4. **更新代码** - 解决 bug 和错误

---

**文档版本**: v2.0  
**最后更新**: 2025-10-21  
**适用范围**: 博客系统所有组件

